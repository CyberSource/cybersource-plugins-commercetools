<!DOCTYPE html>
<html lang="en">

<head>
    <title>ISV Commercetools Plugin</title>
    <base href="/">
    <link rel="stylesheet" href="css/paymentdetails.css">
    <script type="text/javascript" src="javascript/javascriptfunctions.js"></script>
</head>

<body>
    <% if(errorMessage){%>
        <div class="alert alert-error alert-dismissible"><em class="mark error"></em>
            <%=errorMessage%>
        </div>
    <%} %>
    <% if(successMessage){%>
        <div class="alert alert-success alert-dismissible"><em class="mark check"></em>
            <%=successMessage%>
        </div>
    <%} %>
    <table>
        <% var latestTransaction=payments.transactions[payments.transactions.length-1]%>
        <th>Payment details</th>
        <tr>
            <td>Payment Id:</td>
            <td>
                <%= payments.id%>
            </td>
        </tr>
        <tr>
            <td>Amount:</th>
            <td>
                <%=payments.amountPlanned.currencyCode%>
                <%=amountConversion(payments.amountPlanned.centAmount)%>
            </td>
        </tr>
        <tr>
            <td>Payment Interface:</td>
            <td>
                <%= payments.paymentMethodInfo.paymentInterface%>
            </td>
        </tr>
        <tr>
            <td>Payment Method:</td>
            <td>
                <%= payments.paymentMethodInfo.method%>
            </td>
        </tr>
        <% if(payments.custom.fields.isv_token!="" ) {%>
            <tr>
                <td>Token:</td>
                <td>
                    <%=payments.custom.fields.isv_token%>
                </td>
            </tr>
        <% } %>
        <tr>
            <td>Credit Card Number:</td>
            <td>
                <%= payments.custom.fields.isv_maskedPan %>
            </td>
        </tr>
        <tr>
            <td>Credit Card Type:</td>
            <td>
                <%= payments.custom.fields.isv_cardType %>
            </td>
        </tr>
        <tr>
            <td>Credit Card Expiry:</td>
            <td>
                <%=payments.custom.fields.isv_cardExpiryMonth%>/
                    <%=payments.custom.fields.isv_cardExpiryYear %>
            </td>
        </tr>
        <% if(latestTransaction){ %>
            <tr>
                <td>Latest Transaction Id:</td>
                <td>
                    <%=latestTransaction.id%>
                </td>
            </tr>
            <tr>
                <td>Latest Transaction Interaction Id:</td>
                <td>
                    <%=latestTransaction.interactionId%>
                </td>
            </tr>
            <tr>
                <td>Latest Transaction Amount:</td>
                <td>
                    <%=latestTransaction.amount.currencyCode%>
                        <%=amountConversion(latestTransaction.amount.centAmount)%>
                </td>
            </tr>
            <tr>
                <td>Latest Transaction Type:</td>
                <td>
                    <%=latestTransaction.type%>
                </td>
            </tr>
            <tr>
                <td>Latest Transaction State:</td>
                <td>
                    <%=latestTransaction.state %>
                </td>
            </tr>
        <% } %>
    </table>
    <br>
    <% if((captureAmount) && (!(latestTransaction.type=="Charge" && latestTransaction.state=="Initial"
    ))) { %>
        You can refund amount <%= captureAmount%>
    <% } %>
    <br>
    <a class="abutton" href="/orders" role="button">Back</a>
    <% if(latestTransaction) { %>
        <% if((latestTransaction.type=='Authorization' && latestTransaction.state=='Success'
        ) || (latestTransaction.type=='Charge' && latestTransaction.state=='Initial' )
        || (latestTransaction.type=='CancelAuthorization' &&
        latestTransaction.state=='Initial' )) { %>
            <a class="abutton" id="captureId" href="/capture?id=<%=id%>" role="button"
            onclick="showDiv()">Capture</a>
            <a class="abutton" id="authreversalId" href="/authreversal?id=<%=id%>"
            role="button" onclick="showDiv()">Reverse</a>
        <% } %>
        <% if(("Charge"==latestTransaction.type
        && "Success"==latestTransaction.state) || ((captureAmount
        && "Refund"==latestTransaction.type) &&
        (("Success"==latestTransaction.state) ||
        ("Failure"==latestTransaction.state) ||
        ("Initial"==latestTransaction.state)))) {%>
            <form action="/refund">
                <input type="hidden" name="refundId" id="refundId"
                    value="<%=id%>" />
                Refund amount: <input type="text" name="refundAmount"
                    id="refundAmount" size="6" value=""
                    oninput="validateamount(this)" required />
                <button type="submit" id="refundbutton" class="abutton"
                    onclick="showDiv()">Refund</button>
            </form>
        <% } %>
    <% } %>
    <div id="loading"><span> Loading... </span></div>
    <div id="msg"></div>
</body>

</html>